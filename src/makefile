# makefile
# Builds the entire project (and other things)

JC = javac
# where the compiled classes go
BUILD_DIR = ../test
# where javadocs are placed
DOCS_DIR  = ../docs
# -g         - Generate all debugging information
# -Xlint:all - For extra verbosity on errors/warning
# -d         - Sets the destination for built .class files
# -cp        - Class path includes both this directory and GSON library
JFLAGS = -g -d $(BUILD_DIR) -Xlint:all -cp ".:libs/gson-2.6.2.jar"
.SUFFIXES: .java .class
.java.class:
		$(JC) $(JFLAGS) $*.java

# All the files we want to build
CLASSES = \
		Kernelizr.java \
		Kernel.java \
		KTask.java \
		KOps.java \
		BadRaster.java \
		TaskQueue.java \
		KWorker.java \
		JSONKernel.java

# help message by default
.PHONY: default
default:
		@echo "make build      - build project."
		@echo "make clean      - remove generated classes and jars."
		@echo "make rebuild    - clean and build project."
		@echo "make run        - build and run."
		@echo "make docs       - create docs via javadoc."
		@echo "make docs-clean - remove all autogenerated docs."
		@echo "make jar        - rebuild and package into a jar (BROKEN!)."

# build each .java file
classes: $(CLASSES:.java=.class)

build: classes

# remove class files from the build directory and jar files in the main directory
clean:
		$(RM) $(BUILD_DIR)/*.class
		$(RM) ../*.jar

rebuild: clean build

# run the project. We need to explicitly provide the path of the GSON library.
run: build
		java -cp "$(BUILD_DIR)/:libs/gson-2.6.2.jar" Kernelizr $(BUILD_DIR)/datasets/image/103-menger-3840x2160-2_cropped_640x640.png

# build the javadocs for the project
docs:
		javadoc -d $(DOCS_DIR)/javadoc -cp ".:libs/gson-2.6.2.jar" $(CLASSES)

# remove the javadocs
docs-clean:
		$(RM) $(DOCS_DIR)/javadoc/*

# this target is broken (building jars is hard)
jar: rebuild
		jar cvfm ../Kernelizr.jar manifest.txt $(BUILD_DIR)/*.class
